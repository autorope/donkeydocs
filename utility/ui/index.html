<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Donkey UI. - Donkey Car</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Donkey UI.";
        var mkdocs_page_input_path = "utility/ui.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Donkey Car
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/build_hardware/">Build a car.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/install_software/">Install the software.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/create_application/">Create Donkeycar App.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/calibrate/">Calibrate steering and throttle.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/get_driving/">Get driving.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/train_autopilot/">Create an autopilot.</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Donkey UI.</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#the-tub-manager">The tub manager</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-trainer">The trainer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-pilot-arena">The pilot arena</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-car-connection">The car connection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#future-plans">Future plans</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#video-tutorial">Video tutorial</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/deep_learning/simulator/">Donkey Simulator.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/deep_learning/virtual_race_league/">Virtual Race League.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/deep_learning/mobile_app/">Mobile app</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Parts</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/about/">About</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/actuators/">Actuators</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/cameras/">Cameras</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/controllers/">Controllers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/odometry/">Odometry/encoders</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/keras/">Keras</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/stores/">Stores</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/fastai/">Fastai</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/imu/">IMU</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/path_follow/path_follow/">GPS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/lidar/">Lidar</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/oled/">OLED</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/pins/">Pins</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/voice_control/">Voice Control</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../parts/stop_sign_detection/">Stop Sign Detection</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Utilities</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../donkey/">donkey</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Donkey UI.</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#the-tub-manager">The tub manager</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-trainer">The trainer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-pilot-arena">The pilot arena</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-car-connection">The car connection</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#future-plans">Future plans</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#video-tutorial">Video tutorial</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev_guide/contribute/">Contribute</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev_guide/tests/">Tests</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev_guide/model/">Create your own model</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cars</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../cars/supported_cars/">Supported Cars</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cars/roll_your_own/">Roll Your Own</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Support</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../support/faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../support/legacy/">Legacy</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Donkey Car</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Utilities</li>
      <li class="breadcrumb-item active">Donkey UI.</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/autorope/donkeydocs/edit/master/docs/utility/ui.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="donkey-ui">Donkey UI</h1>
<p>Launch the Donkey graphical training interface by entering <code>donkey ui</code> in the command line. This works on Linux, Mac, and Windows, although if you're on Windows it's recommended that you use WSL (<a href="https://docs.microsoft.com/en-us/windows/wsl/install">Windows Subsystem for Linux</a>) running Ubuntu 20 or Ubuntu 22 instead to get full functionality.</p>
<p>The Donkey UI currently contains four screens supporting the following workflows:</p>
<ol>
<li>
<p>The tub manager - a replacement for the web-based application launched through <code>donkey tubclean</code></p>
</li>
<li>
<p>The trainer - a UI based alternative to train the pilot. Note, for longer trainings containing larger tubs or batches it is recommended to perform these in the shell using the <code>donkey train</code> command. The UI based training is geared towards an experimental and rapid analysis cycle consisting of:</p>
<ul>
<li>data manipulation / selection</li>
<li>training</li>
<li>pilot benchmarking</li>
</ul>
</li>
<li>
<p>The pilot arena - here you can test two pilots' performance against each other.</p>
</li>
<li>The car connector - can pull tub data from the car and push back trained pilots or even start/stop the car. The screen does not work under windows.</li>
</ol>
<p><strong><em>Note</em>:</strong> Under linux the app depends on <code>xclip</code>, if this is not installed, then please run:</p>
<pre><code class="language-bash">sudo apt-get install xclip
</code></pre>
<h2 id="the-tub-manager">The tub manager</h2>
<p><img alt="Tub_manager UI" src="../../assets/ui-tub-manager.png" /></p>
<p>In the tub manager screen you have to select the car directory that contains the config file <code>config.py</code> first. Typically, you'll create a <code>mycar</code> directory ("mkdir mycar") and download <a href="https://github.com/autorope/donkeycar/blob/main/donkeycar/templates/cfg_complete.py">this</a> config file, copy it into the <code>mycar</code> directory and rename it to <code>config.py</code>. Then, in the app, just select the <code>mycar</code> directory using the <code>Load car directory</code> button. </p>
<p>Then we'll load the data. If you haven't already created a <code>data</code> directory in your <code>mycar</code> folder, do so now ("mkdir data"). Transfer all the data from the corresponding <code>data</code> folder on your car to this folder, using the "car connection" tab described below or manually using rsync or your other favorite file transfer utility. <em>Note: The term "tub" refers to the directory that holds all the data you recorded from your car</em>. Then select the <code>data</code> folder using the <code>Load tub</code> button (just select the folder, not the manifest files within it). The application remembers the last loaded config and tub.</p>
<p>The drop-down menu <code>Add/remove</code> in the data panel to the left of the image allows to select the record fields, like <code>user/angle</code>, <code>user/throttle</code>, etc. </p>
<p><strong>Note:</strong> if your tub contains more data than the standard <code>user/angle</code>, <code>user/throttle</code> and you want the progress bars to correctly show the values of these fields, you need to add an entry into the <code>.donkeyrc</code> file in your home directory. This file is automatically created by the Donkey UI app. Here is an example:</p>
<pre><code class="language-yaml">field_mapping:
- centered: true
  field: car/accel
  max_value_id: IMU_ACCEL_NORM
</code></pre>
<p>This data entry into the <code>field_mapping</code> list contains the name of the tub field, a switch, if the data is centered around 0 and the name of the maximum value of that data field which has to be provided in the <code>myconfig.py</code> file. For example, the data above represents the IMU acceleration of the IMU6050 which ranges between +/- 2g, i.e. ~ +/-20 m/s<sup>2</sup>. With an IMU_ACCEL_NORM of 20 the progress bar can display these values. Therefore, the <code>myconfig.py</code> should contain:</p>
<pre><code class="language-python">IMU_ACCEL_NORM = 20
</code></pre>
<p><strong>Note</strong>: Vectors, i.e. list / arrays are being decomposed by the UI into their components automatically.</p>
<p>Here is an example of a tub that has <code>car/accel</code> and <code>car/gyro</code> arrays that hold IMU data, as well as <code>car/distance</code> and <code>car/m_in_lap</code>. The first two show a progress bar because there is a corresponding entry in the <code>field_mapping</code> list as explained above.
<img alt="Tub_manager UI_more_data" src="../../assets/ui-tub-manager-2.png" /></p>
<p>The control panel allows moving forward and backward in single steps using &lt;, &gt; and scrolling continuously with &lt;&lt;, &gt;&gt;. These buttons are also linked to the keyboard keys &lt; left &gt;, &lt; right &gt;, &lt; space &gt;.</p>
<p>To delete unwanted records press <code>Set left</code> / <code>Set right</code> buttons to determine the range and hit <code>Delete</code> to remove such records from training. To see the impact on the current tub press <code>Reload tub</code>. If you want to resurrect accidentally deleted records, just choose a left/right value outside the deleted range and press <code>Restore</code>.</p>
<p><strong>Note:</strong> The left/right values are invertible, i.e. left &gt; right operates on all records outside [left, right).</p>
<p>In the filter section you can suppress records, say you want to restrict the next training on only right curves, then add <code>user/angle &gt; 0</code> to select those records.
<strong>Note:</strong> the filter on only for display in the tub manager. If you want to apply this in training you have to write the predicate as explained in <a href="../donkey/">utility</a></p>
<p>The lower panel contains a graph with the currently selected data from the data panel. If nothing is selected, all fields from the record are displayed. The display scales the data between the minimum and maximum value of each record field, hence there are no absolute measurements possible. For more advanced data graphing capabilities, press <code>Browser Graph</code> which opens a plotly history graph in the web browser.</p>
<h2 id="the-trainer">The trainer</h2>
<p><img alt="Trainer UI" src="../../assets/ui-trainer.png" /></p>
<p>The trainer screen allows to train a model to the tub data. In the <code>Overwrite config</code> section you can set any config parameter by typing an updated value into the text field on the right and hitting return. </p>
<p>To train a pilot use the model type dropdown, enter a comment and hit <code>Train</code>. After training, the pilot will appear in the pilot database which is shown underneath. You can also choose a transfer model if you don't want to train from scratch. Note, tensorflow saves the model with the optimiser state, so training will commence where it stopped in the saved state.</p>
<p>Pilots might be trained on multiple tubs, this is currently not supported in the trainer. However, if multiple tubs are passed in <code>donkey train</code> then these will show in the database too. In order to not clutter up the view and group different tubs, you can use the <code>Group multiple tubs</code> button to group all tub groups of two and more, and show a group alias instead. The group alias mapping is shown in the lower area of the window then.</p>
<h2 id="the-pilot-arena">The pilot arena</h2>
<p><img alt="Pilot Arena UI" src="../../assets/ui-pilot-arena.png" /></p>
<p>Here you can benchmark two pilots against each other. Use this panel to test if changes in the training through optimiser parameters or model types, or through deletion of certain records, or augmentations to images have made the pilot better or worse. The last selected pilots will be remembered in the app.</p>
<p>Choose a pilot by selecting the <code>Model type</code> and loading the keras model using the file chooser by pressing <code>Choose pilot</code>. The control panel is the same as in the tub manager. The lower right data panel shows the tub record's data. You can select the throttle field as some folks train on car speed instead of throttle values. In such case, the corresponding field name must be added into the <code>.donkeyrc</code> file in the section, see an example here.</p>
<pre><code class="language-yaml">user_pilot_map:
  car/speed: pilot/speed
  user/angle: pilot/angle
  user/throttle: pilot/throttle
</code></pre>
<p>The 'user/angle' and 'user/throttle' mappings are automatically loaded by the app. In order to show the variable <code>car/speed</code> and compare it to the AI produced <code>pilot/speed</code> the map has to contain the corresponding entry.</p>
<p>Under the two pilots there are sliders with pre-defined image augmentations, here <code>Brightness</code> and <code>Blur</code>. You can mix brightness and blur values into the images and compare how well the pilots are reacting to such a modification of the testing data. Press the buttons to activate the sliders for enabling this feature.</p>
<p>The application will remember the last two selected pilots.</p>
<h2 id="the-car-connection">The car connection</h2>
<p><img alt="Car_Connector_UI" src="../../assets/ui-car-connector-1.png" /></p>
<p><strong><em>Note</em></strong>: This screen will only work on linux / OSX as it makes use of <code>ssh</code> and <code>rsync</code> in the background. SSH needs to be configured to allow login from the PC to the car without password. This can be done by running on the PC:</p>
<pre><code class="language-bash">ssh-keygen
</code></pre>
<p>When being asked for a passphrase just hit &lt;return&gt;. This creates a public and private key in your <code>./ssh</code> directory. Then copy the key over to the car with the command below. Here we assume your car's hostname is <code>donkeypi</code> - otherwise replace it with the corresponding hostname.</p>
<pre><code class="language-bash">ssh-copy-id -i ~/.ssh/id_rsa.pub pi@donkeypi.local
</code></pre>
<p>Log into your car using:</p>
<pre><code class="language-bash">ssh pi@donkeypi.local
</code></pre>
<p>If SSH asks you if that host should be added to the list of known hosts, hit &lt;return&gt; and you are done. From now on, you can ssh into the car without being prompted for the password again. <strong>The login-free setup is required for the screen to work.</strong></p>
<ul>
<li>You also need to edit your myconfig.py and make sure the fields <code>PI_USERNAME</code> and <code>PI_HOSTNAME</code> are set to your car user's username and the hostname of the car.</li>
</ul>
<p>With the car connector you can transfer the tub data from the car to your PC and transfer the pilots back to the car.</p>
<ul>
<li>
<p>Under the <code>Car directory</code> enter the car folder and hit return. This should populate the <code>Select tub</code> drop down. Most likely you want to select the <code>data/</code> directory but you might have tubs in subfolders. In that case use <code>~/mycar/data</code> in the <code>Car directory</code>, select the tub you want to pull and enable <code>Create new folder</code> on the button. This will copy a tub on the car like <code>~/mycar/data/tub_21-04-09_11</code> into the same location on your PC. Without the <code>Create new folder</code> it would copy the content of the car's tub folder into <code>~/mycar/data</code> of your PC, possibly overwriting other tub data that might be there.</p>
</li>
<li>
<p>Press <code>Pull tub data/</code> to copy the tub from the car</p>
</li>
<li>Press <code>Send pilots</code> to sync your local <code>models/</code> folder with the <code>models/</code> folder on the car. This command syncs all pilots that are locally stored.</li>
<li>In the <code>Drive car</code> section you can start the car and also select a model for autonomous driving. After starting you have to use the controller, either web or joystick as usual.</li>
</ul>
<h2 id="future-plans">Future plans</h2>
<ol>
<li>Moving the car connector screen to a web interface, supported on all OS.</li>
<li>Handling of multiple tubs.</li>
<li>The ability to also use the filter in training without the need to edit the <code>myconfig.py</code> file.</li>
<li>Migration of the <code>~/.donkeyrc</code> file to the kivy internal settings.</li>
<li>Support using only a single pilot (or more than two) in the pilot arena.</li>
</ol>
<h2 id="video-tutorial">Video tutorial</h2>
<p>You can find a video tutorial for the UI below</p>
<p><a href="https://www.youtube.com/watch?v=J5-zHNeNebQ"><img alt="Video tutorial" src="https://img.youtube.com/vi/J5-zHNeNebQ/0.jpg" /></a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../donkey/" class="btn btn-neutral float-left" title="donkey"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../dev_guide/contribute/" class="btn btn-neutral float-right" title="Contribute">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/autorope/donkeydocs/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../donkey/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../dev_guide/contribute/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
