<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Actuators - Donkey Car</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Actuators";
        var mkdocs_page_input_path = "parts/actuators.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Donkey Car
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/build_hardware/">Build a car.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/install_software/">Install the software.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/create_application/">Create Donkeycar App.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/calibrate/">Calibrate steering and throttle.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/get_driving/">Get driving.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/train_autopilot/">Create an autopilot.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../utility/ui/">Donkey UI.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/deep_learning/simulator/">Donkey Simulator.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/deep_learning/virtual_race_league/">Virtual Race League.</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/deep_learning/mobile_app/">Mobile app</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Parts</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Actuators</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#standard-rc-with-esc-and-steering-servo">Standard RC with ESC and Steering Servo.</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#using-a-rc-hat-to-generate-the-commands">Using a RC Hat to generate the commands.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#generating-pwm-pulses-with-a-pca9685-servo-controller">Generating PWM pulses with a PCA9685 Servo controller</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#arduino">Arduino</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#calibration">Calibration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#using-the-arduino-actuator-part">Using the arduino actuator part</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hbridge-motor-controller-and-steering-servo">HBridge Motor Controller and Steering Servo</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#3-pin-hbridge-and-steering-servo">3-pin HBridge and Steering Servo</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-pin-hbridge-and-steering-servo">2-pin HBridge and Steering Servo</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hbridge-for-both-steering-and-throttle">HBridge for both Steering and Throttle</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vesc-for-both-steering-and-throttle">VESC for both Steering and Throttle</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#differential-drive-cars">Differential Drive cars</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#3-pin-hbridge-differential-drive">3-pin HBridge Differential Drive</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-pin-hbridge-differential-drive">2 Pin HBridge Differential Drive</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cameras/">Cameras</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../controllers/">Controllers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../odometry/">Odometry/encoders</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../keras/">Keras</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../stores/">Stores</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fastai/">Fastai</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../imu/">IMU</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guide/path_follow/path_follow/">GPS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lidar/">Lidar</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../oled/">OLED</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pins/">Pins</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../voice_control/">Voice Control</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../stop_sign_detection/">Stop Sign Detection</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Utilities</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../utility/donkey/">donkey</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../utility/ui/">Donkey UI.</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev_guide/contribute/">Contribute</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev_guide/tests/">Tests</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dev_guide/model/">Create your own model</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cars</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../cars/supported_cars/">Supported Cars</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../cars/roll_your_own/">Roll Your Own</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Support</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../support/faq/">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../support/legacy/">Legacy</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Donkey Car</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Parts</li>
      <li class="breadcrumb-item active">Actuators</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/autorope/donkeydocs/edit/master/docs/parts/actuators.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="actuators">Actuators</h1>
<p>A car needs a way to to move forward and backward and to turn left and right.  We commonly call devices that produce a physical movement in the robot 'actuators'.  Common actuators are DC motors, Servo motors, continuous servo motors and stepper motors.  There are many, many different ways that these actuators can be combined to propel and turn a robot.  Donkeycar supports two common configurations that can be implemented with various actuators: </p>
<ul>
<li><strong>Car-like vehicles</strong> steer by angling the front wheels left or right and move by turning the drive wheels forward or reverse. Common RC cars fall in this category.</li>
<li><strong>Differential drive vehicles</strong>  have two independently controlled drive wheels to provide both movement and steering.  For instance a differential drive car can be driven straight forward by turning the two drive wheels forward at the same speed. In order to turn, one motor can be driven faster than the other and the car will turn an arc in the direction of the slower motor. <a href="#differential-drive-cars">Differential Drive cars</a> are discussed in a section near the end of this page.</li>
</ul>
<p>Actuators take control signals from the Donkeycar to control their actions.  There are several options for generating these control signals.</p>
<ul>
<li>A RC Hat, which is a board you mount on top of the RaspberryPi to use the regular RC that comes with ready-to-run cars</li>
<li>PCA9685 Servo controller board</li>
<li>RPi/Jetson 40 pin GPIO header<ul>
<li>see <a href="../pins/#generating-pwm-from-the-jetson-nano">Generating PWM from the Jetson Nano</a> for how to enable PWM output from the Jetson Nano 40 pin GPIO header.</li>
</ul>
</li>
<li>Arduino</li>
</ul>
<p>Below we will describe the supported actuator setups and software configuration of their control signals.</p>
<h2 id="standard-rc-with-esc-and-steering-servo">Standard RC with ESC and Steering Servo.</h2>
<p>A standard RC car is equipped with a steering servo for steering the front wheels and an ESC (Electronic Speed Controller) to control the speed of the DC motor driving the wheels.  Both the steering servo and the ESC take a PWM (Pulse Width Modulation) control signal.  A PWM signal is simply a square wave pulse of a certain duration and frequency.  In the case of the steering servo the PWM signal determines the position of the servo's arm, which is generally between 0 degrees (full right) and 180 degrees (full left).  In the case of the ESC the PWM signal determines the direction and speed of the drive motor, from full reverse, through stopped, to full forward.</p>
<ul>
<li>Standard RC servo pulses range from 1 millisecond (full reverse for ESC, fully left for servo) to 2 milliseconds (full forward for ESC, full right for servo) with 1.5 milliseconds being neutral (stopped for ESC, straight for servo).</li>
<li>These pulses are typically sent at 50 hertz (one duty cycle every 20 milliseconds). One duty cycle includes a period where the signal is brought high followed by a period where the signal is brought low.  This means that, using the standard 50hz frequency, a 1 millisecond pulse (1 ms high followed by 19 ms low) represents a 5% duty cycle and a 2 millisecond pulse represents a 10% duty cycle.</li>
<li>The most important part is the length of the pulse; it must be in the range of 1 to 2 milliseconds.  </li>
</ul>
<p><img alt="A diagram showing typical PWM timing for a servomotor (Wikipedia)" src="../../assets/parts/Servomotor_Timing_Diagram.svg" title="A diagram showing typical PWM timing for a servomotor (Wikipedia)" /></p>
<ul>
<li>So this means that if a different frequency is used, then the duty cycle must be adjusted in order to get the 1ms to 2ms pulse.</li>
<li>For instance, if a 60hz frequency is used, then a 1 ms pulse requires a duty cycle of 0.05 * 60 / 50 = 0.06 (6%) duty cycle</li>
<li>We default the frequency of our PCA9685 to 60 hz, so pulses in config are generally based on 60hz frequency and 12 bit values. We use 12 bit values because the PCA9685 has 12 bit resolution. So a 1 ms pulse is 0.06 * 4096 ~= 246, a neutral pulse of 0.09 duty cycle is 0.09 * 4096 ~= 367 and full forward pulse of 0.12 duty cycles is 0.12 * 4096 ~= 492</li>
<li>These are generalizations that are useful for understanding the underlying api call arguments and the values that are generating when calibrating.  The final choice of duty-cycle/pulse length depends on your hardware and perhaps your strategy (you may not want to go too fast,  and so you may choose is low max throttle pwm)</li>
</ul>
<h3 id="using-a-rc-hat-to-generate-the-commands">Using a RC Hat to generate the commands.</h3>
<ul>
<li>You can buy a RC Hat from the Donkeycar Store <a href="https://www.diyrobocars.com/shop/">here</a>. This is the easiest way to go if your car came with a regular RC Transmitter and Receiver. Instructions for using it are on the product page.</li>
</ul>
<h3 id="generating-pwm-pulses-with-a-pca9685-servo-controller">Generating PWM pulses with a PCA9685 Servo controller</h3>
<ul>
<li>The hardware connection of the PCA9685 I2C servo driver board is described fully in the overall setup instructions <a href="../../guide/build_hardware/">here</a></li>
<li>The PCA9685 Servo controller is connected the RaspberryPi or Jetson Nano via the I2C pins on the 40 Pin bus, then the 3 pin cables from the ESC and Steering Servo are connected to the PCA9685, generally to channel 0 and channel 1 respectively. See <a href="../../guide/build_hardware/#step-4-connect-servo-shield-to-raspberry-pi">Step 4: Connect Servo Shield</a>.   Connection of a PCA9685 to a Jetson Nano is the same.</li>
</ul>
<p><strong>Configuration</strong></p>
<ul>
<li>Use <code>DRIVE_TRAIN_TYPE = "PWM_STEERING_THROTTLE"</code> in myconfig.py</li>
<li>Set PCA9685 pin specifiers for <code>PWM_STEERING_PIN</code> and <code>PWM_THROTTLE_PIN</code> in the <code>PWM_STEERING_THROTTLE</code> section of myconfig.py. For example:</li>
</ul>
<pre><code class="language-python">    DRIVE_TRAIN_TYPE = &quot;PWM_STEERING_THROTTLE&quot;

    #
    # PWM_STEERING_THROTTLE
    #
    # Drive train for RC car with a steering servo and ESC.
    # Uses a PwmPin for steering (servo) and a second PwmPin for throttle (ESC)
    # Base PWM Frequence is presumed to be 60hz; use PWM_xxxx_SCALE to adjust pulse with for non-standard PWM frequencies
    #
    PWM_STEERING_THROTTLE = {
        &quot;PWM_STEERING_PIN&quot;: &quot;PCA9685.1:40.0&quot;,   # PCA9685, I2C bus 1, address 0x40, channel 0
        &quot;PWM_STEERING_SCALE&quot;: 1.0,              # used to compensate for PWM frequency differents from 60hz; NOT for adjusting steering range
        &quot;PWM_STEERING_INVERTED&quot;: False,         # True if hardware requires an inverted PWM pulse
        &quot;PWM_THROTTLE_PIN&quot;: &quot;PCA9685.1:40.1&quot;,   # PCA9685, I2C bus 1, address 0x40, channel 1
        &quot;PWM_THROTTLE_SCALE&quot;: 1.0,              # used to compensate for PWM frequence differences from 60hz; NOT for increasing/limiting speed
        &quot;PWM_THROTTLE_INVERTED&quot;: False,         # True if hardware requires an inverted PWM pulse
        &quot;STEERING_LEFT_PWM&quot;: 460,               # pwm value for full left steering
        &quot;STEERING_RIGHT_PWM&quot;: 290,              # pwm value for full right steering
        &quot;THROTTLE_FORWARD_PWM&quot;: 500,            # pwm value for max forward throttle
        &quot;THROTTLE_STOPPED_PWM&quot;: 370,            # pwm value for no movement
        &quot;THROTTLE_REVERSE_PWM&quot;: 220,            # pwm value for max reverse throttle
    }
</code></pre>
<blockquote>
<p>NOTE: the pwm values (<code>STEERING_LEFT_PWM</code>, etc.) differ from car to car and are derived by running the calibration procedure.  See <a href="http://docs.donkeycar.com/guide/calibrate/">Calibrate your Car</a></p>
<p>See <a href="../pins/">pins</a> for a detailed discussion of pin providers and pin specifiers.</p>
</blockquote>
<h3 id="arduino">Arduino</h3>
<p>Arduino can be used in the following fashion to generate PWM signals to control the steering and throttle.</p>
<p>For now the Arduino mode is only tested on the <a href="https://www.lattepanda.com/products/lattepanda-delta-432.html">Latte Panda Delta (LP-D)</a> board.
However it should be straightforward to use it with Raspberry Pi / Jetson Nano (instead of PCA 9685).</p>
<p>Refer to the below block diagram to understand where things fits in.</p>
<p><img alt="block diagram" src="../../assets/Arduino_actuator_blk_dgm.jpg" /></p>
<p>Arduino board should be running the standard firmata sketch (This sketch comes by default when you download the arduino tool). Load the standard firmata sketch (from <em>Examples &gt; Firmata &gt; StandardFirmata</em>) onto the Arduino.
<img alt="wiring diagram" src="../../assets/Arduino_firmata_sketch.jpg" /> 
Further <strong>pymata_aio_</strong> python package needs to be installed on the car computer via <em>pip3 install pymata_aio</em>.</p>
<p>As shown in the block-diagram above LattePanda combines both the x86 CPU and the Connected Arduino into a single board.</p>
<p>The following diagram shows how to connect the Arduino pins to steering servo and ESC.</p>
<p><img alt="wiring diagram" src="../../assets/ArduinoWiring.png" />
Note that the power for the servo is provided by the ESC battery elemininator circuit (BEC) which most ESC's provide.
This is done to avoid supplying the entire servo power from Arduino's 5v.
In large RC cars the servo can drag up to 2 amps, which lead to a destruction of the Arduino.</p>
<h3 id="calibration">Calibration</h3>
<p>Note that the calibration procedure/values are slightly different for the Arduino (than PCA9685).
Note that 90 is the usual midpoint (i.e. 1.5 ms pulse width at 50 Hz), so it is recommended to start
 with 90 and adjust +/- 5 until you figure the desired range for steering / throttle.</p>
<pre><code class="language-bash">(env1) jithu@jithu-lp:~/master/pred_mt/lp/001/donkey$ donkey calibrate --arduino --channel 6
using donkey v2.6.0t ...

pymata_aio Version 2.33 Copyright (c) 2015-2018 Alan Yorinks All rights reserved.

Using COM Port:/dev/ttyACM0

Initializing Arduino - Please wait...
Arduino Firmware ID: 2.5 StandardFirmata.ino
Auto-discovery complete. Found 30 Digital Pins and 12 Analog Pins


Enter a PWM setting to test(0-180)95
Enter a PWM setting to test(0-180)90
Enter a PWM setting to test(0-180)85
...
</code></pre>
<p>Note the <strong>--arduino</strong> switch passed to the calibrate command. Further note that the arduino pin being
 calibrated is passed via the <strong>--channel</strong> parameter.</p>
<h3 id="using-the-arduino-actuator-part">Using the arduino actuator part</h3>
<p>The following snippet illustrates how to exercise the Arduino actuator in the drive() loop:</p>
<pre><code class="language-python">    #Drive train setup
    arduino_controller = ArduinoFirmata(
                                    servo_pin=cfg.STEERING_ARDUINO_PIN,
                                    esc_pin=cfg.THROTTLE_ARDUINO_PIN)

    steering = ArdPWMSteering(controller=arduino_controller,
                        left_pulse=cfg.STEERING_ARDUINO_LEFT_PWM,
                        right_pulse=cfg.STEERING_ARDUINO_RIGHT_PWM)

    throttle = ArdPWMThrottle(controller=arduino_controller,
                        max_pulse=cfg.THROTTLE_ARDUINO_FORWARD_PWM,
                        zero_pulse=cfg.THROTTLE_ARDUINO_STOPPED_PWM,
                        min_pulse=cfg.THROTTLE_ARDUINO_REVERSE_PWM)

    V.add(steering, inputs=['user/angle'])
    V.add(throttle, inputs=['user/throttle'])
</code></pre>
<p>Refer to templates/arduino_drive.py for more details.</p>
<h2 id="hbridge-motor-controller-and-steering-servo">HBridge Motor Controller and Steering Servo</h2>
<p>In this configuration the DC motor that drives the wheels is controlled by an L298N HBridge motor controller or compatible.  Steering the front wheels is accomplished with a Steering Servo that takes an PWM pulse.  The motor driver is wired in one of two ways; 3 pin wiring or 2 pin wiring.</p>
<h3 id="3-pin-hbridge-and-steering-servo">3-pin HBridge and Steering Servo</h3>
<p>A single DC gear motor is controlled with an L298N using two TTL output pins to select direction and a PWM pin to control the power to the motor.</p>
<p><img alt="L298N Motor Driver Module" src="../../assets/L298N-Driver-Board-Module.png" title="L298N Motor Driver Module" />
<strong>L298N Motor Driver Module</strong></p>
<p>See https://www.electronicshub.org/raspberry-pi-l298n-interface-tutorial-control-dc-motor-l298n-raspberry-pi/ for a discussion of how the L298N HBridge module is wired in 3-pin mode to the RaspberryPi GPIO. This also applies to the some other driver chips that emulate the L298N, such as the TB6612FNG motor driver.</p>
<p><strong>Configuration</strong></p>
<ul>
<li>use <code>DRIVETRAIN_TYPE = "SERVO_HBRIDGE_3PIN"</code> in myconfig.py</li>
<li>Example pin specifiers using 40 pin GPIO header to generate signals: </li>
</ul>
<pre><code class="language-python">HBRIDGE_3PIN_FWD = &quot;RPI_GPIO.BOARD.18&quot;   # ttl pin, high enables motor forward 
HBRIDGE_3PIN_BWD = &quot;RPI_GPIO.BOARD.16&quot;   # ttl pin, highenables motor reverse
HBRIDGE_3PIN_DUTY = &quot;RPI_GPIO.BOARD.35&quot;  # provides duty cycle to motor
PWM_STEERING_PIN = &quot;RPI_GPIO.BOARD.33&quot;   # provides servo pulse to steering servo
STEERING_LEFT_PWM = 460         # pwm value for full left steering (use `donkey calibrate` to measure value for your car)
STEERING_RIGHT_PWM = 290        # pwm value for full right steering (use `donkey calibrate` to measure value for your car)
</code></pre>
<p>A PCA9685 could also be used to generate all control signals.  See <a href="../pins/">pins</a> for a detailed discussion of pin providers and pin specifiers.</p>
<h3 id="2-pin-hbridge-and-steering-servo">2-pin HBridge and Steering Servo</h3>
<p>A single DC gear motor is controlled with an 'mini' L298d HBridge (or an L9110S HBridge) using 2 PWM pins; one pwm pin to enable and control forward speed and one to enable and control reverse motor speed.</p>
<p><img alt="L293D Motor Driver Module" src="../../assets/MINI-L293D-Motor-driver-module.png" title="L293D Motor Driver Module" />
<strong>L293D Motor Driver Module</strong></p>
<p>See https://www.instructables.com/Tutorial-for-Dual-Channel-DC-Motor-Driver-Board-PW/ for how an L298d mini-hbridge module is wired in 2-pin mode.<br />
See https://electropeak.com/learn/interfacing-l9110s-dual-channel-h-bridge-motor-driver-module-with-arduino/ for how an L9110S/HG7881 motor driver module is wired.</p>
<p><strong>Configuration</strong></p>
<ul>
<li>use <code>DRIVETRAIN_TYPE = "SERVO_HBRIDGE_2PIN"</code> in myconfig.py</li>
<li>Example pin specifiers using 40 pin GPIO header to generate signals: </li>
</ul>
<pre><code class="language-python">  HBRIDGE_2PIN_DUTY_FWD = &quot;RPI_GPIO.BOARD.18&quot;  # provides forward duty cycle to motor
  HBRIDGE_2PIN_DUTY_BWD = &quot;RPI_GPIO.BOARD.16&quot;  # provides reverse duty cycle to motor
  PWM_STEERING_PIN = &quot;RPI_GPIO.BOARD.33&quot;       # provides servo pulse to steering servo
  STEERING_LEFT_PWM = 460         # pwm value for full left steering (use `donkey calibrate` to measure value for your car)
  STEERING_RIGHT_PWM = 290        # pwm value for full right steering (use `donkey calibrate` to measure value for your car)
</code></pre>
<p>A PCA9685 could also be used to generate all control signals.  See <a href="../pins/">pins</a> for a detailed discussion of pin providers and pin specifiers.</p>
<h2 id="hbridge-for-both-steering-and-throttle">HBridge for both Steering and Throttle</h2>
<p>Some very inexpensive toy cars use a DC motor to drive the back wheels forward and reverse and another DC motor to steer the front wheels left or right.  A single L298N HBridge (or L9110S HBridge) can be used to control these two motors.  This driver assumes 2-pin wiring where each motor uses two PWM pins, one for each direction.</p>
<p><strong>Configuration</strong></p>
<ul>
<li>use <code>DRIVETRAIN_TYPE = "DC_STEER_THROTTLE"</code> in myconfig.py</li>
<li>Example pin specifiers using 40 pin GPIO header to generate signals: </li>
</ul>
<pre><code class="language-python">  HBRIDGE_PIN_LEFT = &quot;RPI_GPIO.BOARD.18&quot;   # pwm pin produces duty cycle for steering left
  HBRIDGE_PIN_RIGHT = &quot;RPI_GPIO.BOARD.16&quot;  # pwm pin produces duty cycle for steering right
  HBRIDGE_PIN_FWD = &quot;RPI_GPIO.BOARD.15&quot;    # pwm pin produces duty cycle for forward drive
  HBRIDGE_PIN_BWD = &quot;RPI_GPIO.BOARD.13&quot;    # pwm pin produces duty cycle for reverse drive
</code></pre>
<p>A PCA9685 could also be used to generate all control signals.  See <a href="../pins/">pins</a> for a detailed discussion of pin providers and pin specifiers.</p>
<h2 id="vesc-for-both-steering-and-throttle">VESC for both Steering and Throttle</h2>
<p>VESC is an advanced version of ESC that provides you a lot of customization options on how the ESC operates. It includes features such as regenerative braking, temperature control etc.</p>
<p>This was tested with a VESC 6 and Traxxas Brushless Motor
Follow this F1Tenth tutorial to update your VESC firmware and calibrate it: <a href="https://f1tenth.readthedocs.io/en/stable/getting_started/firmware/firmware_vesc.html">https://f1tenth.readthedocs.io/en/stable/getting_started/firmware/firmware_vesc.html</a>
It's important to use the servo out bin so that we can control steering with the VESC as well</p>
<p>Requires installation of PyVESC from source for servo control (pip install git+https://github.com/LiamBindle/PyVESC.git@master)
<strong>Configuration</strong></p>
<ul>
<li>use <code>DRIVETRAIN_TYPE = "VESC"</code> in myconfig.py</li>
<li>Example parameters </li>
</ul>
<pre><code class="language-python">  VESC_MAX_SPEED_PERCENT =.2  # Max speed as a percent of the actual speed
  VESC_SERIAL_PORT= &quot;/dev/ttyACM0&quot; # Serial device to use for communication. Can check with ls /dev/tty*
  VESC_HAS_SENSOR= True # Whether or not the bldc motor is using a hall effect sensor
  VESC_START_HEARTBEAT= True # Whether or not to automatically start the heartbeat thread that will keep commands alive.
  VESC_BAUDRATE= 115200 # baudrate for the serial communication. Shouldn't need to change this.
  VESC_TIMEOUT= 0.05 # timeout for the serial communication
  VESC_STEERING_SCALE= 0.5 # VESC accepts steering inputs from 0 to 1. Joystick is usually -1 to 1. This changes it to -0.5 to 0.5
  VESC_STEERING_OFFSET = 0.5 # VESC accepts steering inputs from 0 to 1. Coupled with above change we move Joystick to 0 to 1
</code></pre>
<h2 id="differential-drive-cars">Differential Drive cars</h2>
<p>An inexpensive Donkeycar compatible robot can be constructed using a cheap smart car robot chassis that includes 2 DC gear motors and an L298N motor driver or compatible to run the motors.  Steering is accomplished by running one motor faster than the other, causing the car to drive in an arc.  The motor driver can be wired in one of two ways; 3 pin wiring or 2 pin wiring.  The name of the DonkeyCar drivetrains for differential drive all start with <code>DC_TWO_WHEEL</code>.</p>
<h3 id="3-pin-hbridge-differential-drive">3-pin HBridge Differential Drive</h3>
<p>2 DC gear motors are controlled with an L298N, each motor using two TTL output pins to select direction and a PWM pin to control the power to the motor.  Since each motor uses 3 pins, so a total of 6 pins are used in a differential drive configuration. The advantage of this wiring scheme is that it only requires 2 PWM pins, which happens to be the maximum number of PWM pins on the Jetson Nano.</p>
<p>See https://www.electronicshub.org/raspberry-pi-l298n-interface-tutorial-control-dc-motor-l298n-raspberry-pi/ for a discussion of how the L298N HBridge module is wired in 3-pin mode to the RaspberryPi GPIO. This also applies to the some other driver chips that emulate the L298N, such as the TB6612FNG motor driver.</p>
<p><strong>Configuration</strong></p>
<ul>
<li>use <code>DRIVETRAIN_TYPE = "DC_TWO_WHEEL_L298N"</code> in myconfig.py</li>
<li>Example pin specifiers using 40 pin GPIO header to generate signals: </li>
</ul>
<pre><code class="language-python">DC_TWO_WHEEL_L298N = {
    &quot;LEFT_FWD_PIN&quot;: &quot;RPI_GPIO.BOARD.16&quot;,        # TTL output pin enables left wheel forward
    &quot;LEFT_BWD_PIN&quot;: &quot;RPI_GPIO.BOARD.18&quot;,        # TTL output pin enables left wheel reverse
    &quot;LEFT_EN_DUTY_PIN&quot;: &quot;RPI_GPIO.BOARD.22&quot;,    # PWM pin generates duty cycle for left motor speed

    &quot;RIGHT_FWD_PIN&quot;: &quot;RPI_GPIO.BOARD.15&quot;,       # TTL output pin enables right wheel forward
    &quot;RIGHT_BWD_PIN&quot;: &quot;RPI_GPIO.BOARD.13&quot;,       # TTL output pin enables right wheel reverse
    &quot;RIGHT_EN_DUTY_PIN&quot;: &quot;RPI_GPIO.BOARD.11&quot;,   # PWM pin generates duty cycle for right wheel speed
}
</code></pre>
<ul>
<li>Example pin specifiers using a PCA9685 to generate signals: </li>
</ul>
<pre><code class="language-python">DC_TWO_WHEEL_L298N = {
    &quot;LEFT_FWD_PIN&quot;: &quot;PCA9685.1:40.3&quot;,        # TTL output pin enables left wheel forward
    &quot;LEFT_BWD_PIN&quot;: &quot;PCA9685.1:40.2&quot;,        # TTL output pin enables left wheel reverse
    &quot;LEFT_EN_DUTY_PIN&quot;: &quot;PCA9685.1:40.1&quot;,    # PWM pin generates duty cycle for left motor speed

    &quot;RIGHT_FWD_PIN&quot;: &quot;PCA9685.1:40.6&quot;,       # TTL output pin enables right wheel forward
    &quot;RIGHT_BWD_PIN&quot;: &quot;PCA9685.1:40.5&quot;,       # TTL output pin enables right wheel reverse
    &quot;RIGHT_EN_DUTY_PIN&quot;: &quot;PCA9685.1:40.4&quot;,   # PWM pin generates duty cycle for right wheel speed
}
</code></pre>
<ul>
<li>In the configuration, the HBRIDGE_L298N_PIN_xxxx_EN pins determine how fast the motors spin.  These pins must support PWM output.  Remember that the Jetson Nano only supports 2 PWM output pins and only if they are enabled using <code>/opt/nvidia/jetson-io/jetson-io.py</code>. See <a href="../pins/#generating-pwm-from-the-jetson-nano">Generating PWM from the Jetson Nano</a>.</li>
<li>The HBRIDGE_L298N_PIN_xxxx_FWD and HBRIDGE_L298N_PIN_xxxx_BWD pins are TTL output pins that determine the direction the motors spin.</li>
</ul>
<blockquote>
<p>See <a href="../pins/">pins</a> for a detailed discussion of pin providers and pin specifiers.</p>
</blockquote>
<h3 id="2-pin-hbridge-differential-drive">2 Pin HBridge Differential Drive</h3>
<p>2 DC Motors controlled with an 'mini' L293D HBridge, each motor using 2 PWM pins; one pwm pin to enable and control forward speed and one to enable and control reverse motor speed.  This advantage of this wiring method is that it only requires a total of 4 pins; however all of those pins must be able to output PWM.  </p>
<ul>
<li>See <a href="https://www.instructables.com/Tutorial-for-Dual-Channel-DC-Motor-Driver-Board-PW/">L293 Tutorial</a> for how an L293D mini-HBridge module is wired in 2-pin mode. </li>
<li>This driver can also be used with an L9110S/HG7881 motor driver.  See <a href="https://electropeak.com/learn/interfacing-l9110s-dual-channel-h-bridge-motor-driver-module-with-arduino/">Interfacing L9110S</a> for how an L9110S motor driver module is wired.  </li>
<li>The driver can also be used with a DRV8833.  See <a href="https://electropeak.com/learn/interfacing-drv8833-dual-motor-driver-module-with-arduino/">DRV8833 HBridge</a> for how to interface to an arduino.</li>
</ul>
<p><strong>Configuration</strong></p>
<ul>
<li>use <code>DRIVETRAIN_TYPE = "DC_TWO_WHEEL"</code> in myconfig.py</li>
<li>example pin specifiers using the 40 pin GPIO to generate signals: </li>
</ul>
<pre><code class="language-python">DC_TWO_WHEEL = {
    &quot;LEFT_FWD_DUTY_PIN&quot;: &quot;RPI_GPIO.BCM.16&quot;,  # BCM.16 == BOARD.36, pwm pin produces duty cycle for left wheel forward
    &quot;LEFT_BWD_DUTY_PIN&quot;: &quot;RPI_GPIO.BCM.20&quot;,  # BCM.20 == BOARD.38, pwm pin produces duty cycle for left wheel reverse
    &quot;RIGHT_FWD_DUTY_PIN&quot;: &quot;RPI_GPIO.BCM.5&quot;,  # BCM.5 == BOARD.29, pwm pin produces duty cycle for right wheel forward
    &quot;RIGHT_BWD_DUTY_PIN&quot;: &quot;RPI_GPIO.BCM.6&quot;,  # BCM.6 == BOARD.31, pwm pin produces duty cycle for right wheel reverse
}
</code></pre>
<ul>
<li>example pin specifiers using a PCA9685 to generate signals: </li>
</ul>
<pre><code class="language-python">DC_TWO_WHEEL = {
    &quot;LEFT_FWD_DUTY_PIN&quot;: &quot;PCA9685.1:40.0&quot;,  # pwm pin produces duty cycle for left wheel forward
    &quot;LEFT_BWD_DUTY_PIN&quot;: &quot;PCA9685.1:40.1&quot;,  # pwm pin produces duty cycle for left wheel reverse
    &quot;RIGHT_FWD_DUTY_PIN&quot;: &quot;PCA9685.1:40.5&quot;,  # pwm pin produces duty cycle for right wheel forward
    &quot;RIGHT_BWD_DUTY_PIN&quot;: &quot;PCA9685.1:40.6&quot;,  # pwm pin produces duty cycle for right wheel reverse
}
</code></pre>
<blockquote>
<p>See <a href="../pins/">pins</a> for a detailed discussion of pin providers and pin specifiers.</p>
</blockquote>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../about/" class="btn btn-neutral float-left" title="About"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../cameras/" class="btn btn-neutral float-right" title="Cameras">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/autorope/donkeydocs/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../about/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cameras/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
